<!-- templates/register.html -->
{% extends "base.html" %}

{% block content %}
<div class="max-w-md mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold mb-6 text-center">Регистрация</h1>

    <form id="register-form" class="space-y-4">
        <div>
            <label for="username" class="block text-sm font-medium">Логин</label>
            <input type="text" id="username" name="username" required
                   class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
        </div>

        <div>
            <label for="password" class="block text-sm font-medium">Пароль</label>
            <input type="password" id="password" name="password" required
                   class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
        </div>

        <div>
            <label for="confirm-password" class="block text-sm font-medium">Подтвердите пароль</label>
            <input type="password" id="confirm-password" name="confirm-password" required
                   class="mt-1 block w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700">
        </div>

        <button type="submit" class="w-full bg-green-500 hover:bg-green-600 text-white p-2 rounded-md">
            Зарегистрироваться
        </button>

        <div class="text-center">
            <a href="/login" class="text-blue-500 hover:text-blue-600 text-sm">Уже есть аккаунт? Войдите</a>
        </div>
    </form>

    <div id="error-message" class="mt-4 hidden p-3 bg-red-100 dark:bg-red-900 text-red-700 dark:text-red-100 rounded-md"></div>
    <div id="success-message" class="mt-4 hidden p-3 bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-100 rounded-md"></div>
</div>

<script>
document.getElementById('register-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const confirmPassword = document.getElementById('confirm-password').value;
    const errorEl = document.getElementById('error-message');
    const successEl = document.getElementById('success-message');

    errorEl.classList.add('hidden');
    successEl.classList.add('hidden');

    if (password !== confirmPassword) {
        errorEl.textContent = 'Пароли не совпадают';
        errorEl.classList.remove('hidden');
        return;
    }

    try {
        const response = await fetch('/auth/register', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `username=${encodeURIComponent(username)}&password=${encodeURIComponent(password)}`
        });

        if (!response.ok) {
            const data = await response.json();
            errorEl.textContent = data.detail || 'Ошибка регистрации';
            errorEl.classList.remove('hidden');
            return;
        }

        successEl.textContent = 'Регистрация успешна! Теперь вы можете войти.';
        successEl.classList.remove('hidden');

        // Очищаем форму
        document.getElementById('register-form').reset();

    } catch (error) {
        errorEl.textContent = 'Ошибка соединения с сервером';
        errorEl.classList.remove('hidden');
    }
});
</script>
{% endblock %}