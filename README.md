# Leasing Tools AI

## Описание

Leasing Tools AI - веб-приложение на базе FastAPI, предназначенное для автоматизации и анализа рабочих процессов в лизинговой компании. Система использует языковые модели (LLM) для семантического анализа пакета документов по сделкам, по технологии RAG, автоматической генерации документов по шаблонам и проведения экспресс-анализа контрагентов через внешние API.

## Основные функциональные возможности

* **AI-ассистент:** Реализован чат для взаимодействия с LLM, которая предоставляет ответы на вопросы пользователей, основываясь на данных из загруженных в систему документов по лизинговым сделкам.
* **Генерация документов:** Система позволяет автоматически создавать стандартизированные документы (например, заявки на лизинг) в формате `.docx` на основе данных, введенных пользователем через веб-интерфейс.
* **Проверка контрагентов:** Интегрированы внешние API для проведения скоринга и анализа компаний по ИНН, что позволяет получать аналитические справки для оценки их благонадежности.
* **Аутентификация и авторизация:** Система безопасности построена на основе JWT-токенов, которые передаются через secure httponly cookie для защиты от XSS-атак.
* **Управление файлами:** Реализован интерфейс для загрузки, хранения и управления файлами, которые служат источником данных для аналитических модулей.

## Технологический стек

### Бэкенд

* **Framework:** FastAPI
* **ORM:** SQLAlchemy
* **База данных:** PostgreSQL
* **Валидация данных:** Pydantic
* **Взаимодействие с LLM:** LangChain (с поддержкой моделей ChatGPT, Gemini, DeepSeek)
* **Векторное хранилище:** ChromaDB
* **Работа с документами:** `python-docx`, `docxtpl`

### Фронтенд

* **Шаблонизатор:** Jinja2
* **Стилизация:** Tailwind CSS
* **Клиентская логика:** Vanilla JavaScript

## Архитектура проекта

Проект следует принципу разделения ответственности (Separation of Concerns) со следующей структурой:

* `app/routes`: Модули, отвечающие за обработку HTTP-запросов (endpoints), валидацию входящих данных и вызов соответствующей бизнес-логики.
* `app/services`: Модули, инкапсулирующие основную бизнес-логику, включая взаимодействие с внешними API, обработку данных и работу с документами.
* `app/models.py`: Определения моделей базы данных с использованием SQLAlchemy ORM.
* `app/schemas.py`: Pydantic-схемы для валидации и сериализации данных, используемых в API.
* `app/database.py`: Конфигурация подключения к базе данных.
* `app/config.py`: Управление конфигурацией приложения, включая загрузку переменных окружения.
* `app/templates`: HTML-шаблоны для пользовательского интерфейса.
* `app/static`: Статические файлы (JavaScript, CSS, изображения).

## Установка и запуск

### Требования

* Python 3.8+
* PostgreSQL

### Инструкции

1.  **Клонирование репозитория:**
    ```bash
    git clone <URL репозитория>
    cd <папка проекта>
    ```

2.  **Создание и активация виртуального окружения:**
    ```bash
    python -m venv venv
    source venv/bin/activate  # Для Windows: venv\Scripts\activate
    ```

3.  **Установка зависимостей:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Настройка переменных окружения:**
    Создайте файл `.env` в корневой директории проекта, скопировав содержимое из `.env.example`. Заполните его необходимыми значениями:
    ```env
    # Настройки базы данных
    POSTGRES_USER=your_user
    POSTGRES_PASSWORD=your_password
    POSTGRES_HOST=localhost
    POSTGRES_PORT=5432
    POSTGRES_DB=leasing_db

    # Ключ для подписи JWT
    SECRET_KEY=your_strong_secret_jwt_key

    # API ключи для внешних сервисов
    AITUNNEL_API_KEY=your_aitunnel_key
    CHECKO_API_KEY=your_checko_key
    DELTA_LOGIN=your_delta_login
    DELTA_PASSWORD=your_delta_password
    DELTA_SB_LOGIN=your_delta_sb_login
    DELTA_SB_PASSWORD=your_delta_sb_password
    ```

5.  **Применение миграций базы данных:**
    При использовании Alembic выполните команду:
    ```bash
    alembic upgrade head
    ```

6.  **Запуск приложения:**
    Для запуска ASGI-сервера выполните команду:
    ```bash
    uvicorn app.main:app --reload
    ```
    Приложение будет доступно по адресу `http://127.0.0.1:8000`.
